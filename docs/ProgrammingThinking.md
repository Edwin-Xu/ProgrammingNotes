# PRogramming Thinking

## 

面试问我：两个机器之间发一个人40mb的文件，咋样用tcp发最快。我只能想到开多个tcp链接并行传。。。。。



**提高效率在于找到瓶颈，解决瓶颈**。提高硬件利用率。所以有以下方面可以优化:
1、机器间带宽是多少？如果只能百兆，千兆，并且不可提升，则这个就是最大瓶颈。达到最大带宽，再优化对速度而言已经无效。
2、执行效率，可以从多个维度来考虑。如果考察的是从程序启动，到发送完成。那么最简单首先要减少拷贝次数，如果只是考察单文件发送，不需要考虑多次重复，则需要提高tcp发送效率。提高tcp发送效率，需要考虑开启巨帧，但要看有没有经过路由器。如果不考虑丢包的情况，则需要考虑滑动窗口扩大的机制。考虑丢包则比较复杂了，这里略过。对tcp而言，延迟是一个关键变量，可以通过延迟和每个包的最大大小，来计算出需要几个线程来占满带宽。对于文件的读写，也可能需要考虑是否采用内存映射来提高效率。
总之，不同场景下需要考虑或者关注的因素是有很大差别的，简单的方案是开足够多的线程，占满带宽，减少拷贝次数。



是的，这种思维方式才是最重要的。有一句话说得很好：**如果无法评估，则无法优化**。评估是非常非常重要的，你说好，你说改进了，那么怎么去证明呢？很多时候，**比起毫无头绪，更可怕的是意淫**[坏笑]

